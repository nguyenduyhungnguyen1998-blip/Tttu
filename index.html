<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tam ThÃ¡i Tá»­ â€” ThÃ¡p HÃ  Ná»™i (Báº£n NÃ¢ng Cáº¥p)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="stylesen.css">
</head>
<body>
  <!-- Popups ban Ä‘áº§u -->
  <div id="greetingPopup" class="fullscreen-overlay">
    <div class="box">
      <h2 style="margin:0">ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ThÃ¡p HÃ  Ná»™i!</h2>
      <div style="color:var(--muted);margin-top:8px">Äá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t, báº¡n cÃ³ muá»‘n báº­t nháº¡c ná»n khÃ´ng?</div>
      <div style="margin-top:12px; display:flex; justify-content:center; gap: 12px;">
        <button id="musicYes" class="btn">CÃ³, báº­t nháº¡c</button>
        <button id="musicNo" class="ghost">KhÃ´ng, cáº£m Æ¡n</button>
      </div>
    </div>
  </div>

  <div id="modeSelect" class="fullscreen-overlay" style="display:none;">
    <div class="box">
      <h2 style="margin:0">Chá»n cháº¿ Ä‘á»™</h2>
      <div style="color:var(--muted);margin-top:8px">Báº¯t Ä‘áº§u báº±ng cÃ¡ch chá»n má»™t cháº¿ Ä‘á»™. Báº¡n cÃ³ thá»ƒ Ä‘á»•i láº¡i sau.</div>
      <div class="mode-grid" role="list">
        <div class="mode-card" id="mode-play" role="listitem" tabindex="0"><h3>ğŸ® Play</h3><p>ChÆ¡i tá»± do: kÃ©o tháº£, tÃ­nh giá», lÆ°u ká»· lá»¥c.</p></div>
        <div class="mode-card" id="mode-teach" role="listitem" tabindex="0"><h3>ğŸ“ Teach</h3><p>Há»c cÃ¡ch giáº£i. Game sáº½ gá»£i Ã½ vÃ  chá» báº¡n Ä‘i Ä‘Ãºng.</p></div>
        <div class="mode-card" id="mode-learn" role="listitem" tabindex="0"><h3>ğŸ§  Learn (Äá»‡ quy)</h3><p>Trá»±c quan hÃ³a thuáº­t toÃ¡n, call stack & tá»«ng bÆ°á»›c.</p></div>
        <div class="mode-card" id="mode-demo" role="listitem" tabindex="0"><h3>ğŸ¤– Demo</h3><p>Xem mÃ¡y tá»± Ä‘á»™ng giáº£i vá»›i sá»‘ bÆ°á»›c tá»‘i Æ°u.</p></div>
        <div class="mode-card" id="mode-challenge" role="listitem" tabindex="0"><h3>â±ï¸ Challenge</h3><p>HoÃ n thÃ nh trong thá»i háº¡n. Thua sáº½... "Háº¿t giá»!".</p></div>
      </div>
      <div style="margin-top:12px;display:flex;justify-content:center"><button id="modeStart" class="btn">XÃ¡c nháº­n</button></div>
    </div>
  </div>

  <!-- á»¨ng dá»¥ng chÃ­nh -->
  <div class="app" id="app">
    <div class="header">
      <h1>Tam ThÃ¡i Tá»­</h1>
      <div class="kv" style="margin-left: 12px; font-weight: 600;">Mode: <span id="currentModeDisplay" style="color: var(--accent);">Play</span></div>
      <div class="topmeta">
        <div class="badge">Moves: <span id="mv" aria-live="polite">0</span></div>
        <div class="badge">Best (<span id="best-n">4</span> Ä‘Ä©a): <span id="best">â€”</span></div>
        <div class="badge">Time: <span id="tm" aria-live="polite">00:00</span></div>
      </div>
    </div>

    <div class="main-content-grid">
      <div class="controls-and-analysis">
        <div class="controls">
          <div class="row">
            <label>Sá»‘ Ä‘Ä©a: <input id="n" type="number" min="1" max="10" value="4"></label>
            <label>Theme:
              <select id="theme" class="theme-select">
                <option value="classic">âœ¨ Classic</option>
                <option value="burger">ğŸ” Burger</option>
                <option value="rescue">ğŸ± MÃ¨o</option>
                <option value="neon">ğŸŒˆ Neon</option>
                <option value="dark">ğŸŒ™ Dark Cozy</option>
              </select>
            </label>
            <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
                <label for="bgm-upload-input" class="ghost" style="cursor: pointer;">Táº£i nháº¡c ná»n</label>
                <input type="file" id="bgm-upload-input" accept="audio/*" style="display:none;">
                <label class="kv">Ã‚m: <input id="snd" type="checkbox" checked></label>
            </div>
          </div>

          <div class="row" style="align-items:center">
             <label style="display: none;">Tá»‘c Ä‘á»™ (Demo):
              <select id="spd" class="speed-select">
                <option value="1200">Cháº­m</option><option value="700" selected>Vá»«a</option><option value="300">Nhanh</option>
              </select>
            </label>
            <button class="btn" id="reset">Reset</button>
            <button class="ghost" id="changeMode">Äá»•i Cháº¿ Ä‘á»™</button>
            <button class="ghost" id="undo" disabled>Undo</button>
            <button class="ghost" id="hint">Gá»£i Ã½</button>
            <!-- NÃšT Má»šI -->
            <button class="ghost" id="appPopupButton">á»¨ng dá»¥ng thá»±c tiá»…n</button>
          </div>
        </div>

        <!-- MODULE PHÃ‚N TÃCH THUáº¬T TOÃN Má»šI -->
        <div id="analysisPanel" class="analysis-panel">
          <h3>PhÃ¢n tÃ­ch Thuáº­t toÃ¡n</h3>
          <p>Vá»›i <strong id="analysisN">4</strong> Ä‘Ä©a, sá»‘ bÆ°á»›c di chuyá»ƒn tá»‘i thiá»ƒu lÃ  <strong id="analysisMoves">15</strong>.</p>
          <p class="fact"><strong>Sá»± tháº­t thÃº vá»‹:</strong> Theo truyá»n thuyáº¿t, bÃ i toÃ¡n cÃ³ 64 Ä‘Ä©a. Náº¿u má»—i bÆ°á»›c di chuyá»ƒn máº¥t 1 giÃ¢y, sáº½ cáº§n tá»›i <strong id="analysisTime">585 tá»· nÄƒm</strong> Ä‘á»ƒ hoÃ n thÃ nh, dÃ i hÆ¡n cáº£ tuá»•i cá»§a vÅ© trá»¥!</p>
        </div>
      </div>

      <div class="wrap-stage" id="stage">
        <div class="pole" id="a"><div class="peg"></div><div class="pole-label">1</div></div>
        <div class="pole" id="b"><div class="peg"></div><div class="pole-label">2</div></div>
        <div class="pole" id="c"><div class="peg"></div><div class="pole-label">3</div></div>
      </div>
    </div>
    
    <div class="footer-bar">
      <div class="progress" title="Tiáº¿n Ä‘á»™"><i id="prog"></i></div>
      <div class="hud">
        <div class="kv">Mode hint: <span id="hintText" aria-live="polite">â€”</span></div>
      </div>
    </div>
    <div class="footerNote">Máº¹o: KÃ©o tháº£ hoáº·c dÃ¹ng phÃ­m sá»‘ (1, 2, 3) Ä‘á»ƒ chá»n cá»c vÃ  di chuyá»ƒn Ä‘Ä©a. Nháº¥n 'Esc' Ä‘á»ƒ há»§y.</div>
  </div>

  <!-- CÃ¡c popup káº¿t quáº£ vÃ  luáº­t chÆ¡i -->
  <div id="finish" class="finishPop"></div>
  <div id="nearOptimal" class="finishPop"></div>
  <div id="loserPopup" class="popup" style="display:none"><div class="popup-box">...</div></div>

  <!-- POPUP á»¨NG Dá»¤NG THá»°C TIá»„N Má»šI -->
  <div id="appPopup" class="popup" style="display:none;">
    <div class="popup-box" style="text-align: left; max-width: 500px;">
      <span class="close-btn" id="closeAppPopup">&times;</span>
      <h3>á»¨ng dá»¥ng cá»§a TÆ° duy Äá»‡ quy & ThÃ¡p HÃ  Ná»™i</h3>
      <p style="font-size: 14px; color: var(--muted); line-height: 1.5;">
        DÃ¹ lÃ  má»™t trÃ² chÆ¡i cá»• xÆ°a, ThÃ¡p HÃ  Ná»™i minh há»a cho má»™t khÃ¡i niá»‡m cá»±c ká»³ máº¡nh máº½ trong khoa há»c mÃ¡y tÃ­nh: <strong>Äá»‡ quy</strong> (Recursion). Viá»‡c giáº£i má»™t bÃ i toÃ¡n lá»›n báº±ng cÃ¡ch chia nÃ³ thÃ nh cÃ¡c bÃ i toÃ¡n nhá» hÆ¡n, giá»‘ng há»‡t nhÆ°ng Ä‘Æ¡n giáº£n hÆ¡n lÃ  cá»‘t lÃµi cá»§a nhiá»u thuáº­t toÃ¡n hiá»‡n Ä‘áº¡i.
      </p>
      <ul>
        <li><strong>Cáº¥u trÃºc ThÆ° má»¥c:</strong> Há»‡ thá»‘ng file vÃ  thÆ° má»¥c trÃªn mÃ¡y tÃ­nh cá»§a báº¡n lÃ  má»™t cáº¥u trÃºc Ä‘á»‡ quy. Má»™t thÆ° má»¥c cÃ³ thá»ƒ chá»©a cÃ¡c file vÃ  cÃ¡c thÆ° má»¥c con khÃ¡c.</li>
        <li><strong>Thuáº­t toÃ¡n Sáº¯p xáº¿p:</strong> CÃ¡c thuáº­t toÃ¡n sáº¯p xáº¿p hiá»‡u quáº£ nhÆ° QuickSort vÃ  MergeSort hoáº¡t Ä‘á»™ng dá»±a trÃªn nguyÃªn lÃ½ "chia Ä‘á»ƒ trá»‹" cá»§a Ä‘á»‡ quy.</li>
        <li><strong>TrÃ­ tuá»‡ NhÃ¢n táº¡o (AI):</strong> AI thÆ°á»ng sá»­ dá»¥ng Ä‘á»‡ quy Ä‘á»ƒ duyá»‡t qua cÃ¡c cÃ¢y quyáº¿t Ä‘á»‹nh, tÃ¬m kiáº¿m nÆ°á»›c Ä‘i tá»‘t nháº¥t trong cÃ¡c trÃ² chÆ¡i nhÆ° cá» vua.</li>
        <li><strong>Äá»“ há»a MÃ¡y tÃ­nh:</strong> Váº½ cÃ¡c hÃ¬nh áº£nh phá»©c táº¡p nhÆ° cÃ¢y cá»‘i hay bÃ´ng tuyáº¿t (fractals) thÆ°á»ng dÃ¹ng Ä‘áº¿n Ä‘á»‡ quy.</li>
      </ul>
      <p style="font-size: 14px; text-align:center; margin-top: 16px;">
        <button id="closeAppPopupBtn" class="btn">TÃ´i Ä‘Ã£ hiá»ƒu</button>
      </p>
    </div>
  </div>

  <audio id="bgm" loop preload="auto"><source src="smooth-gaming-atmosphere-323659.mp3" type="audio/mpeg"></audio>
  <canvas id="confetti"></canvas>
  <div id="learnPanel">...</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script src="ap.js" defer></script>
</body>
</html>