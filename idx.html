<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tam ThÃ¡i Tá»­ â€” ThÃ¡p HÃ  Ná»™i (Báº£n NÃ¢ng Cáº¥p)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="stylesen.css">
</head>
<body>
  <div id="greetingPopup" class="fullscreen-overlay">
    <div class="box">
      <h2 style="margin:0">ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ThÃ¡p HÃ  Ná»™i!</h2>
      <div style="color:var(--muted);margin-top:8px">Äá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t, báº¡n cÃ³ muá»‘n báº­t nháº¡c ná»n khÃ´ng?</div>
      <div style="margin-top:12px; display:flex; justify-content:center; gap: 12px;">
        <button id="musicYes" class="btn">CÃ³, báº­t nháº¡c</button>
        <button id="musicNo" class="ghost">KhÃ´ng, cáº£m Æ¡n</button>
      </div>
    </div>
  </div>

  <div id="modeSelect" class="fullscreen-overlay" style="display:none;">
    <div class="box">
      <h2 style="margin:0">Chá»n cháº¿ Ä‘á»™</h2>
      <div style="color:var(--muted);margin-top:8px">Báº¯t Ä‘áº§u báº±ng cÃ¡ch chá»n má»™t cháº¿ Ä‘á»™. Báº¡n cÃ³ thá»ƒ Ä‘á»•i láº¡i sau.</div>
      <div class="mode-grid" role="list">
        <div class="mode-card" id="mode-play" role="listitem" tabindex="0">
          <h3>ğŸ® Play</h3>
          <p>ChÆ¡i tá»± do: kÃ©o tháº£, tÃ­nh giá», lÆ°u ká»· lá»¥c.</p>
        </div>
         <div class="mode-card" id="mode-teach" role="listitem" tabindex="0">
          <h3>ğŸ“ Teach</h3>
          <p>Há»c cÃ¡ch giáº£i. Game sáº½ gá»£i Ã½ vÃ  chá» báº¡n Ä‘i Ä‘Ãºng.</p>
        </div>
        <div class="mode-card" id="mode-learn" role="listitem" tabindex="0">
          <h3>ğŸ§  Learn (Äá»‡ quy)</h3>
          <p>Trá»±c quan hÃ³a thuáº­t toÃ¡n, call stack & tá»«ng bÆ°á»›c.</p>
        </div>
        <div class="mode-card" id="mode-demo" role="listitem" tabindex="0">
          <h3>ğŸ¤– Demo</h3>
          <p>Xem mÃ¡y tá»± Ä‘á»™ng giáº£i vá»›i sá»‘ bÆ°á»›c tá»‘i Æ°u.</p>
        </div>
        <div class="mode-card" id="mode-challenge" role="listitem" tabindex="0">
          <h3>â±ï¸ Challenge</h3>
          <p>HoÃ n thÃ nh trong thá»i háº¡n. Thua sáº½... "Háº¿t giá»!".</p>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;justify-content:center">
        <button id="modeStart" class="btn">XÃ¡c nháº­n</button>
      </div>
    </div>
  </div>

  <div class="app" id="app">
    <div class="header">
      <h1>Tam ThÃ¡i Tá»­</h1>
      <div class="kv" style="margin-left: 12px; font-weight: 600;">Mode: <span id="currentModeDisplay" style="color: var(--accent);">Play</span></div>
      <div class="topmeta">
        <div class="badge">Moves: <span id="mv" aria-live="polite">0</span></div>
        <div class="badge">Best (<span id="best-n">4</span> Ä‘Ä©a): <span id="best">â€”</span></div>
        <div class="badge">Time: <span id="tm" aria-live="polite">00:00</span></div>
      </div>
    </div>

    <div class="controls">
      <div class="row">
        <label>Sá»‘ Ä‘Ä©a: <input id="n" type="number" min="1" max="8" value="4"></label>
        <label>Theme:
          <select id="theme" class="theme-select">
            <option value="classic">âœ¨ Classic</option>
            <option value="burger">ğŸ” Burger</option>
            <option value="rescue">ğŸ± MÃ¨o</option>
            <option value="neon">ğŸŒˆ Neon</option>
            <option value="dark">ğŸŒ™ Dark Cozy</option>
          </select>
        </label>
        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
            <label for="bgm-upload-input" class="ghost" style="cursor: pointer;">Táº£i nháº¡c ná»n</label>
            <input type="file" id="bgm-upload-input" accept="audio/*" style="display:none;">
            <label class="kv">Ã‚m: <input id="snd" type="checkbox" checked></label>
        </div>
      </div>

      <div class="row" style="align-items:center">
        <label style="display: none;">Tá»‘c Ä‘á»™ (Demo):
          <select id="spd" class="speed-select">
            <option value="1200">Cháº­m</option>
            <option value="700" selected>Vá»«a</option>
            <option value="300">Nhanh</option>
          </select>
        </label>

        <button class="btn" id="reset">Reset</button>
        <button class="ghost" id="changeMode">Äá»•i Cháº¿ Ä‘á»™</button>
        <button class="ghost" id="undo" disabled>Undo</button>
        <button class="ghost" id="auto">Auto-solve</button>
        <button class="ghost" id="hint">Gá»£i Ã½</button>

        <div style="margin-left:auto;display:flex;gap:12px;align-items:center">
          <div class="progress" title="Tiáº¿n Ä‘á»™"><i id="prog"></i></div>
          <div class="hud"><div class="kv">Mode hint: <span id="hintText" aria-live="polite">â€”</span></div></div>
        </div>
      </div>
    </div>

    <div class="wrap-stage" id="stage">
      <div class="pole" id="a"><div class="peg"></div><div class="pole-label" style="position:absolute; bottom:-20px; font-weight: 700;">1</div></div>
      <div class="pole" id="b"><div class="peg"></div><div class="pole-label" style="position:absolute; bottom:-20px; font-weight: 700;">2</div></div>
      <div class="pole" id="c"><div class="peg"></div><div class="pole-label" style="position:absolute; bottom:-20px; font-weight: 700;">3</div></div>
    </div>

    <div class="footerNote">Máº¹o: KÃ©o tháº£ hoáº·c dÃ¹ng phÃ­m sá»‘ (1, 2, 3) Ä‘á»ƒ chá»n cá»c vÃ  di chuyá»ƒn Ä‘Ä©a. Nháº¥n 'Esc' Ä‘á»ƒ há»§y.</div>
  </div>

  <div id="finish" class="finishPop"></div>
  <div id="nearOptimal" class="finishPop" style="min-width:320px;display:flex;align-items:center;justify-content:center;flex-direction:column;"></div>

  <div id="popup-rule1" class="popup" aria-hidden="false" style="display:none;">
    <div class="popup-box">
      <div style="font-weight:800;font-size:18px;margin-bottom:8px">Báº¡n Ä‘Ã£ biáº¿t luáº­t chÆ¡i ThÃ¡p HÃ  Ná»™i chÆ°a?</div>
      <div class="popup-actions">
        <button id="popup-yes" class="btn">Biáº¿t rá»“i</button>
        <button id="popup-no" class="ghost">ChÆ°a biáº¿t</button>
      </div>
    </div>
  </div>

  <div id="popup-rule2" class="popup" aria-hidden="true" style="display:none;">
    <div class="popup-box">
      <h3>Luáº­t chÆ¡i ThÃ¡p HÃ  Ná»™i</h3>
      <div style="text-align:left;font-size:13px;color:var(--muted);line-height:1.35">
        <p style="margin:6px 0;"><strong>Má»¥c tiÃªu:</strong> Chuyá»ƒn toÃ n bá»™ Ä‘Ä©a tá»« cá»™t A sang cá»™t C.</p>
        <ol style="margin:4px 0 8px 20px;">
          <li>Má»—i láº§n chá»‰ Ä‘Æ°á»£c di chuyá»ƒn 1 Ä‘Ä©a.</li>
          <li>KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t Ä‘Ä©a lá»›n lÃªn trÃªn Ä‘Ä©a nhá».</li>
          <li>Giá»¯ nguyÃªn thá»© tá»± Ä‘Ä©a trÃªn cá»™t khi chuyá»ƒn.</li>
        </ol>
        <p style="margin-top:6px">HÃ£y cá»‘ gáº¯ng hoÃ n thÃ nh vá»›i sá»‘ bÆ°á»›c cÃ ng nhá» cÃ ng tá»‘t!.</p>
      </div>
      <div style="display:flex;justify-content:center;margin-top:12px">
        <button id="popup-start" class="btn">Báº¯t Ä‘áº§u</button>
      </div>
    </div>
  </div>

  <div id="loserPopup" class="popup" style="display:none"><div class="popup-box"><div style="font-weight:900;font-size:20px;color:#d23"></div><div style="margin-top:12px"><button id="loserClose" class="btn">ÄÃ³ng</button></div></div></div>

  <audio id="bgm" loop preload="auto">
    <source src="smooth-gaming-atmosphere-323659.mp3" type="audio/mpeg">
  </audio>

  <div id="learnPanel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">Learn Trace (Äá»‡ quy)</div>
      <div style="font-size:13px;color:var(--muted)">n = <span id="learnN">4</span></div>
    </div>
    <div id="stackArea"></div>
    <div id="learnExplain"></div>
    <div style="display:flex;gap:8px;margin-top:10px;justify-content:center">
      <button id="learnPrev" class="ghost">Prev</button>
      <button id="learnPlay" class="btn">Play</button>
      <button id="learnPause" class="ghost" style="display:none">Pause</button>
      <button id="learnNext" class="ghost">Next</button>
    </div>
    <div style="display:flex;justify-content:center;margin-top:8px">
      <label style="font-size:13px;color:var(--muted)">Speed:
        <select id="learnSpeed" class="speed-select"><option value="1200">Slow</option><option value="700" selected>Medium</option><option value="300">Fast</option></select>
      </label>
    </div>
  </div>

  <canvas id="confetti"></canvas>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script src="ap.js" defer></script>
</body>
</html>